package contract

import (
	"strings"

	"github.com/ethereum/go-ethereum/accounts/abi"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/ethereum/go-ethereum/crypto"
)

const (
	EmptyEvmAddress = "0x0000000000000000000000000000000000000000"

	FIP20LogicAddress = "0x0000000000000000000000000000000000001001"
	WFXLogicAddress   = "0x0000000000000000000000000000000000001002"

	StakingAddress    = "0x0000000000000000000000000000000000001003"
	CrossChainAddress = "0x0000000000000000000000000000000000001004"
)

var (
	initFIP20Code = MustDecodeHex("0x60806040526004361061011f5760003560e01c8063715018a6116100a0578063b86d529811610064578063b86d529814610306578063c5cb9b5114610324578063dd62ed3e14610344578063de7ea79d1461038a578063f2fde38b146103aa5761011f565b8063715018a61461026a5780638da5cb5b1461027f57806395d89b41146102b15780639dc29fac146102c6578063a9059cbb146102e65761011f565b80633659cfe6116100e75780633659cfe6146101e057806340c10f19146102025780634f1ef2861461022257806352d1902d1461023557806370a082311461024a5761011f565b806306fdde0314610124578063095ea7b31461014f57806318160ddd1461017f57806323b872dd1461019e578063313ce567146101be575b600080fd5b34801561013057600080fd5b506101396103ca565b6040516101469190611b46565b60405180910390f35b34801561015b57600080fd5b5061016f61016a3660046118d3565b61045c565b6040519015158152602001610146565b34801561018b57600080fd5b5060cc545b604051908152602001610146565b3480156101aa57600080fd5b5061016f6101b9366004611839565b6104b2565b3480156101ca57600080fd5b5060cb5460405160ff9091168152602001610146565b3480156101ec57600080fd5b506102006101fb3660046117ed565b610561565b005b34801561020e57600080fd5b5061020061021d3660046118d3565b610641565b610200610230366004611874565b610657565b34801561024157600080fd5b50610190610724565b34801561025657600080fd5b506101906102653660046117ed565b6107d7565b34801561027657600080fd5b506102006107f6565b34801561028b57600080fd5b506097546001600160a01b03165b6040516001600160a01b039091168152602001610146565b3480156102bd57600080fd5b5061013961080a565b3480156102d257600080fd5b506102006102e13660046118d3565b610819565b3480156102f257600080fd5b5061016f6103013660046118d3565b61082b565b34801561031257600080fd5b5060cf546001600160a01b0316610299565b34801561033057600080fd5b5061016f61033f366004611a27565b610841565b34801561035057600080fd5b5061019061035f366004611807565b6001600160a01b03918216600090815260ce6020908152604080832093909416825291909152205490565b34801561039657600080fd5b506102006103a536600461199e565b6108f7565b3480156103b657600080fd5b506102006103c53660046117ed565b610a66565b606060c980546103d990611d1f565b80601f016020809104026020016040519081016040528092919081815260200182805461040590611d1f565b80156104525780601f1061042757610100808354040283529160200191610452565b820191906000526020600020905b81548152906001019060200180831161043557829003601f168201915b5050505050905090565b6000610469338484610adc565b6040518281526001600160a01b0384169033907f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259060200160405180910390a350600192915050565b6001600160a01b038316600090815260ce60209081526040808320338452909152812054828110156105355760405162461bcd60e51b815260206004820152602160248201527f7472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636044820152606560f81b60648201526084015b60405180910390fd5b61054985336105448685611cdc565b610adc565b610554858585610b5e565b60019150505b9392505050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000010011614156105aa5760405162461bcd60e51b815260040161052c90611b88565b7f00000000000000000000000000000000000000000000000000000000000010016001600160a01b03166105f3600080516020611d87833981519152546001600160a01b031690565b6001600160a01b0316146106195760405162461bcd60e51b815260040161052c90611bd4565b61062281610d0d565b6040805160008082526020820190925261063e91839190610d15565b50565b610649610e99565b6106538282610ef3565b5050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000010011614156106a05760405162461bcd60e51b815260040161052c90611b88565b7f00000000000000000000000000000000000000000000000000000000000010016001600160a01b03166106e9600080516020611d87833981519152546001600160a01b031690565b6001600160a01b03161461070f5760405162461bcd60e51b815260040161052c90611bd4565b61071882610d0d565b61065382826001610d15565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000100116146107c45760405162461bcd60e51b815260206004820152603860248201527f555550535570677261646561626c653a206d757374206e6f742062652063616c60448201527f6c6564207468726f7567682064656c656761746563616c6c0000000000000000606482015260840161052c565b50600080516020611d8783398151915290565b6001600160a01b038116600090815260cd60205260409020545b919050565b6107fe610e99565b6108086000610fd2565b565b606060ca80546103d990611d1f565b610821610e99565b6106538282611024565b6000610838338484610b5e565b50600192915050565b600063ffffffff333b16156108985760405162461bcd60e51b815260206004820152601960248201527f63616c6c65722063616e6e6f7420626520636f6e747261637400000000000000604482015260640161052c565b6108a53386868686611166565b336001600160a01b03167f282dd1817b996776123a00596764d4d54cc16460c9854f7a23f6be020ba0463d868686866040516108e49493929190611b59565b60405180910390a2506001949350505050565b600054610100900460ff16158080156109175750600054600160ff909116105b806109315750303b158015610931575060005460ff166001145b6109945760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b606482015260840161052c565b6000805460ff1916600117905580156109b7576000805461ff0019166101001790555b84516109ca9060c99060208801906116e0565b5083516109de9060ca9060208701906116e0565b5060cb805460ff191660ff851617905560cf80546001600160a01b0319166001600160a01b038416179055610a11611285565b610a196112b4565b8015610a5f576000805461ff0019169055604051600181527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b5050505050565b610a6e610e99565b6001600160a01b038116610ad35760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b606482015260840161052c565b61063e81610fd2565b6001600160a01b038316610b325760405162461bcd60e51b815260206004820152601d60248201527f617070726f76652066726f6d20746865207a65726f2061646472657373000000604482015260640161052c565b6001600160a01b03928316600090815260ce602090815260408083209490951682529290925291902055565b6001600160a01b038316610bb45760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f20616464726573730000604482015260640161052c565b6001600160a01b038216610c0a5760405162461bcd60e51b815260206004820152601c60248201527f7472616e7366657220746f20746865207a65726f206164647265737300000000604482015260640161052c565b6001600160a01b038316600090815260cd602052604090205481811015610c735760405162461bcd60e51b815260206004820152601f60248201527f7472616e7366657220616d6f756e7420657863656564732062616c616e636500604482015260640161052c565b610c7d8282611cdc565b6001600160a01b03808616600090815260cd60205260408082209390935590851681529081208054849290610cb3908490611cc4565b92505081905550826001600160a01b0316846001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610cff91815260200190565b60405180910390a350505050565b61063e610e99565b7f4910fdfa16fed3260ed0e7147f7cc6da11a60208b5b9406d12a635614ffd91435460ff1615610d4d57610d48836112db565b610e94565b826001600160a01b03166352d1902d6040518163ffffffff1660e01b815260040160206040518083038186803b158015610d8657600080fd5b505afa925050508015610db6575060408051601f3d908101601f19168201909252610db39181019061191c565b60015b610e195760405162461bcd60e51b815260206004820152602e60248201527f45524331393637557067726164653a206e657720696d706c656d656e7461746960448201526d6f6e206973206e6f74205555505360901b606482015260840161052c565b600080516020611d878339815191528114610e885760405162461bcd60e51b815260206004820152602960248201527f45524331393637557067726164653a20756e737570706f727465642070726f786044820152681a58589b195555525160ba1b606482015260840161052c565b50610e94838383611377565b505050565b6097546001600160a01b031633146108085760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604482015260640161052c565b6001600160a01b038216610f495760405162461bcd60e51b815260206004820152601860248201527f6d696e7420746f20746865207a65726f20616464726573730000000000000000604482015260640161052c565b8060cc6000828254610f5b9190611cc4565b90915550506001600160a01b038216600090815260cd602052604081208054839290610f88908490611cc4565b90915550506040518181526001600160a01b038316906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a35050565b609780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b6001600160a01b03821661107a5760405162461bcd60e51b815260206004820152601a60248201527f6275726e2066726f6d20746865207a65726f2061646472657373000000000000604482015260640161052c565b6001600160a01b038216600090815260cd6020526040902054818110156110e35760405162461bcd60e51b815260206004820152601b60248201527f6275726e20616d6f756e7420657863656564732062616c616e63650000000000604482015260640161052c565b6110ed8282611cdc565b6001600160a01b038416600090815260cd602052604081209190915560cc805484929061111b908490611cdc565b90915550506040518281526000906001600160a01b038516907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a3505050565b6001600160a01b0385166111bc5760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f20616464726573730000604482015260640161052c565b60008451116112015760405162461bcd60e51b81526020600482015260116024820152701a5b9d985b1a59081c9958da5c1a595b9d607a1b604482015260640161052c565b8061123f5760405162461bcd60e51b815260206004820152600e60248201526d1a5b9d985b1a59081d185c99d95d60921b604482015260640161052c565b60cf546112609086906001600160a01b031661125b8587611cc4565b610b5e565b61127d8585858585604051806020016040528060008152506113a2565b505050505050565b600054610100900460ff166112ac5760405162461bcd60e51b815260040161052c90611c20565b61080861145a565b600054610100900460ff166108085760405162461bcd60e51b815260040161052c90611c20565b6001600160a01b0381163b6113485760405162461bcd60e51b815260206004820152602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201526c1bdd08184818dbdb9d1c9858dd609a1b606482015260840161052c565b600080516020611d8783398151915280546001600160a01b0319166001600160a01b0392909216919091179055565b6113808361148a565b60008251118061138d5750805b15610e945761139c83836114ca565b50505050565b600080806110046113b78a8a8a8a8a8a6115be565b6040516113c49190611aa5565b6000604051808303816000865af19150503d8060008114611401576040519150601f19603f3d011682016040523d82523d6000602084013e611406565b606091505b5091509150611444828260405180604001604052806016815260200175199a5c0b58dc9bdcdccb58da185a5b8819985a5b195960521b815250611611565b61144d8161168b565b9998505050505050505050565b600054610100900460ff166114815760405162461bcd60e51b815260040161052c90611c20565b61080833610fd2565b611493816112db565b6040516001600160a01b038216907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b90600090a250565b60606001600160a01b0383163b6115325760405162461bcd60e51b815260206004820152602660248201527f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f6044820152651b9d1c9858dd60d21b606482015260840161052c565b600080846001600160a01b03168460405161154d9190611aa5565b600060405180830381855af49150503d8060008114611588576040519150601f19603f3d011682016040523d82523d6000602084013e61158d565b606091505b50915091506115b58282604051806060016040528060278152602001611da7602791396116a2565b95945050505050565b60608686868686866040516024016115db96959493929190611afe565b60408051601f198184030181529190526020810180516001600160e01b0316633c3e7d7760e01b17905290509695505050505050565b82610e945760008280602001905181019061162c9190611934565b9050600182511015611652578060405162461bcd60e51b815260040161052c9190611b46565b8181604051602001611665929190611ac1565b60408051601f198184030181529082905262461bcd60e51b825261052c91600401611b46565b6000808280602001905181019061055a91906118fc565b606083156116b157508161055a565b61055a83838151156116c65781518083602001fd5b8060405162461bcd60e51b815260040161052c9190611b46565b8280546116ec90611d1f565b90600052602060002090601f01602090048101928261170e5760008555611754565b82601f1061172757805160ff1916838001178555611754565b82800160010185558215611754579182015b82811115611754578251825591602001919060010190611739565b50611760929150611764565b5090565b5b808211156117605760008155600101611765565b600061178c61178784611c9c565b611c6b565b90508281528383830111156117a057600080fd5b828260208301376000602084830101529392505050565b80356001600160a01b03811681146107f157600080fd5b600082601f8301126117de578081fd5b61055a83833560208501611779565b6000602082840312156117fe578081fd5b61055a826117b7565b60008060408385031215611819578081fd5b611822836117b7565b9150611830602084016117b7565b90509250929050565b60008060006060848603121561184d578081fd5b611856846117b7565b9250611864602085016117b7565b9150604084013590509250925092565b60008060408385031215611886578182fd5b61188f836117b7565b9150602083013567ffffffffffffffff8111156118aa578182fd5b8301601f810185136118ba578182fd5b6118c985823560208401611779565b9150509250929050565b600080604083850312156118e5578182fd5b6118ee836117b7565b946020939093013593505050565b60006020828403121561190d578081fd5b8151801515811461055a578182fd5b60006020828403121561192d578081fd5b5051919050565b600060208284031215611945578081fd5b815167ffffffffffffffff81111561195b578182fd5b8201601f8101841361196b578182fd5b805161197961178782611c9c565b81815285602083850101111561198d578384fd5b6115b5826020830160208601611cf3565b600080600080608085870312156119b3578081fd5b843567ffffffffffffffff808211156119ca578283fd5b6119d6888389016117ce565b955060208701359150808211156119eb578283fd5b506119f8878288016117ce565b935050604085013560ff81168114611a0e578182fd5b9150611a1c606086016117b7565b905092959194509250565b60008060008060808587031215611a3c578384fd5b843567ffffffffffffffff811115611a52578485fd5b611a5e878288016117ce565b97602087013597506040870135966060013595509350505050565b60008151808452611a91816020860160208601611cf3565b601f01601f19169290920160200192915050565b60008251611ab7818460208701611cf3565b9190910192915050565b60008351611ad3818460208801611cf3565b6101d160f51b9083019081528351611af2816002840160208801611cf3565b01600201949350505050565b6001600160a01b038716815260c060208201819052600090611b2290830188611a79565b86604084015285606084015284608084015282810360a084015261144d8185611a79565b60006020825261055a6020830184611a79565b600060808252611b6c6080830187611a79565b6020830195909552506040810192909252606090910152919050565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b19195b1959d85d1958d85b1b60a21b606082015260800190565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b6163746976652070726f787960a01b606082015260800190565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b606082015260800190565b604051601f8201601f1916810167ffffffffffffffff81118282101715611c9457611c94611d70565b604052919050565b600067ffffffffffffffff821115611cb657611cb6611d70565b50601f01601f191660200190565b60008219821115611cd757611cd7611d5a565b500190565b600082821015611cee57611cee611d5a565b500390565b60005b83811015611d0e578181015183820152602001611cf6565b8381111561139c5750506000910152565b600281046001821680611d3357607f821691505b60208210811415611d5457634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fdfe360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c206661696c6564a264697066735822122051e0aed842c0559223420ca2eefef201271cb3ffa78d13dd3d726b371752d56364736f6c63430008020033")
	initWFXCode   = MustDecodeHex("0x6080604052600436106101445760003560e01c8063715018a6116100b6578063c5cb9b511161006f578063c5cb9b511461038f578063d0e30db014610153578063dd62ed3e146103a2578063de7ea79d146103e8578063f2fde38b14610408578063f3fef3a31461042857610153565b8063715018a6146102d55780638da5cb5b146102ea57806395d89b411461031c5780639dc29fac14610331578063a9059cbb14610351578063b86d52981461037157610153565b8063313ce56711610108578063313ce567146102155780633659cfe61461023757806340c10f19146102575780634f1ef2861461027757806352d1902d1461028a57806370a082311461029f57610153565b806306fdde031461015b578063095ea7b31461018657806318160ddd146101b657806323b872dd146101d55780632e1a7d4d146101f557610153565b3661015357610151610448565b005b610151610448565b34801561016757600080fd5b50610170610489565b60405161017d9190611d09565b60405180910390f35b34801561019257600080fd5b506101a66101a1366004611a93565b61051b565b604051901515815260200161017d565b3480156101c257600080fd5b5060cc545b60405190815260200161017d565b3480156101e157600080fd5b506101a66101f03660046119f2565b610571565b34801561020157600080fd5b50610151610210366004611c24565b610620565b34801561022157600080fd5b5060cb5460405160ff909116815260200161017d565b34801561024357600080fd5b50610151610252366004611973565b610691565b34801561026357600080fd5b50610151610272366004611a93565b610771565b610151610285366004611a32565b610787565b34801561029657600080fd5b506101c7610854565b3480156102ab57600080fd5b506101c76102ba366004611973565b6001600160a01b0316600090815260cd602052604090205490565b3480156102e157600080fd5b50610151610907565b3480156102f657600080fd5b506097546001600160a01b03165b6040516001600160a01b03909116815260200161017d565b34801561032857600080fd5b5061017061091b565b34801561033d57600080fd5b5061015161034c366004611a93565b61092a565b34801561035d57600080fd5b506101a661036c366004611a93565b61093c565b34801561037d57600080fd5b5060cf546001600160a01b0316610304565b6101a661039d366004611bd2565b610952565b3480156103ae57600080fd5b506101c76103bd3660046119ba565b6001600160a01b03918216600090815260ce6020908152604080832093909416825291909152205490565b3480156103f457600080fd5b50610151610403366004611b47565b610a16565b34801561041457600080fd5b50610151610423366004611973565b610b85565b34801561043457600080fd5b5061015161044336600461198f565b610bfb565b6104523334610c80565b60405134815233907fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c9060200160405180910390a2565b606060c9805461049890611ee2565b80601f01602080910402602001604051908101604052809291908181526020018280546104c490611ee2565b80156105115780601f106104e657610100808354040283529160200191610511565b820191906000526020600020905b8154815290600101906020018083116104f457829003601f168201915b5050505050905090565b6000610528338484610d58565b6040518281526001600160a01b0384169033907f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259060200160405180910390a350600192915050565b6001600160a01b038316600090815260ce60209081526040808320338452909152812054828110156105f45760405162461bcd60e51b815260206004820152602160248201527f7472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636044820152606560f81b60648201526084015b60405180910390fd5b61060885336106038685611e9f565b610d58565b610613858585610dda565b60019150505b9392505050565b61062b335b82610f89565b604051339082156108fc029083906000818181858888f19350505050158015610658573d6000803e3d6000fd5b5060405181815233907f884edad9ce6fa2440d8a54cc123490eb96d2768479d49ff9c7366125a94243649060200160405180910390a250565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000010021614156106da5760405162461bcd60e51b81526004016105eb90611d4b565b7f00000000000000000000000000000000000000000000000000000000000010026001600160a01b0316610723600080516020611f5f833981519152546001600160a01b031690565b6001600160a01b0316146107495760405162461bcd60e51b81526004016105eb90611d97565b610752816110cb565b6040805160008082526020820190925261076e918391906110d3565b50565b610779611257565b6107838282610c80565b5050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000010021614156107d05760405162461bcd60e51b81526004016105eb90611d4b565b7f00000000000000000000000000000000000000000000000000000000000010026001600160a01b0316610819600080516020611f5f833981519152546001600160a01b031690565b6001600160a01b03161461083f5760405162461bcd60e51b81526004016105eb90611d97565b610848826110cb565b610783828260016110d3565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000100216146108f45760405162461bcd60e51b815260206004820152603860248201527f555550535570677261646561626c653a206d757374206e6f742062652063616c60448201527f6c6564207468726f7567682064656c656761746563616c6c000000000000000060648201526084016105eb565b50600080516020611f5f83398151915290565b61090f611257565b61091960006112b1565b565b606060ca805461049890611ee2565b610932611257565b6107838282610f89565b6000610949338484610dda565b50600192915050565b600063ffffffff333b16156109a95760405162461bcd60e51b815260206004820152601960248201527f63616c6c65722063616e6e6f7420626520636f6e74726163740000000000000060448201526064016105eb565b34156109b7576109b7610448565b6109c43386868686611303565b336001600160a01b03167f282dd1817b996776123a00596764d4d54cc16460c9854f7a23f6be020ba0463d86868686604051610a039493929190611d1c565b60405180910390a2506001949350505050565b600054610100900460ff1615808015610a365750600054600160ff909116105b80610a505750303b158015610a50575060005460ff166001145b610ab35760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b60648201526084016105eb565b6000805460ff191660011790558015610ad6576000805461ff0019166101001790555b8451610ae99060c990602088019061187d565b508351610afd9060ca90602087019061187d565b5060cb805460ff191660ff851617905560cf80546001600160a01b0319166001600160a01b038416179055610b30611422565b610b38611451565b8015610b7e576000805461ff0019169055604051600181527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b5050505050565b610b8d611257565b6001600160a01b038116610bf25760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b60648201526084016105eb565b61076e816112b1565b610c0433610625565b6040516001600160a01b0383169082156108fc029083906000818181858888f19350505050158015610c3a573d6000803e3d6000fd5b506040518181526001600160a01b0383169033907f9b1bfa7fa9ee420a16e124f794c35ac9f90472acc99140eb2f6447c714cad8eb906020015b60405180910390a35050565b6001600160a01b038216610cd65760405162461bcd60e51b815260206004820152601860248201527f6d696e7420746f20746865207a65726f2061646472657373000000000000000060448201526064016105eb565b8060cc6000828254610ce89190611e87565b90915550506001600160a01b038216600090815260cd602052604081208054839290610d15908490611e87565b90915550506040518181526001600160a01b038316906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef90602001610c74565b6001600160a01b038316610dae5760405162461bcd60e51b815260206004820152601d60248201527f617070726f76652066726f6d20746865207a65726f206164647265737300000060448201526064016105eb565b6001600160a01b03928316600090815260ce602090815260408083209490951682529290925291902055565b6001600160a01b038316610e305760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f2061646472657373000060448201526064016105eb565b6001600160a01b038216610e865760405162461bcd60e51b815260206004820152601c60248201527f7472616e7366657220746f20746865207a65726f20616464726573730000000060448201526064016105eb565b6001600160a01b038316600090815260cd602052604090205481811015610eef5760405162461bcd60e51b815260206004820152601f60248201527f7472616e7366657220616d6f756e7420657863656564732062616c616e63650060448201526064016105eb565b610ef98282611e9f565b6001600160a01b03808616600090815260cd60205260408082209390935590851681529081208054849290610f2f908490611e87565b92505081905550826001600160a01b0316846001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610f7b91815260200190565b60405180910390a350505050565b6001600160a01b038216610fdf5760405162461bcd60e51b815260206004820152601a60248201527f6275726e2066726f6d20746865207a65726f206164647265737300000000000060448201526064016105eb565b6001600160a01b038216600090815260cd6020526040902054818110156110485760405162461bcd60e51b815260206004820152601b60248201527f6275726e20616d6f756e7420657863656564732062616c616e6365000000000060448201526064016105eb565b6110528282611e9f565b6001600160a01b038416600090815260cd602052604081209190915560cc8054849290611080908490611e9f565b90915550506040518281526000906001600160a01b038516907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a3505050565b61076e611257565b7f4910fdfa16fed3260ed0e7147f7cc6da11a60208b5b9406d12a635614ffd91435460ff161561110b5761110683611478565b611252565b826001600160a01b03166352d1902d6040518163ffffffff1660e01b815260040160206040518083038186803b15801561114457600080fd5b505afa925050508015611174575060408051601f3d908101601f1916820190925261117191810190611ac5565b60015b6111d75760405162461bcd60e51b815260206004820152602e60248201527f45524331393637557067726164653a206e657720696d706c656d656e7461746960448201526d6f6e206973206e6f74205555505360901b60648201526084016105eb565b600080516020611f5f83398151915281146112465760405162461bcd60e51b815260206004820152602960248201527f45524331393637557067726164653a20756e737570706f727465642070726f786044820152681a58589b195555525160ba1b60648201526084016105eb565b50611252838383611514565b505050565b6097546001600160a01b031633146109195760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e657260448201526064016105eb565b609780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b6001600160a01b0385166113595760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f2061646472657373000060448201526064016105eb565b600084511161139e5760405162461bcd60e51b81526020600482015260116024820152701a5b9d985b1a59081c9958da5c1a595b9d607a1b60448201526064016105eb565b806113dc5760405162461bcd60e51b815260206004820152600e60248201526d1a5b9d985b1a59081d185c99d95d60921b60448201526064016105eb565b60cf546113fd9086906001600160a01b03166113f88587611e87565b610dda565b61141a85858585856040518060200160405280600081525061153f565b505050505050565b600054610100900460ff166114495760405162461bcd60e51b81526004016105eb90611de3565b6109196115f7565b600054610100900460ff166109195760405162461bcd60e51b81526004016105eb90611de3565b6001600160a01b0381163b6114e55760405162461bcd60e51b815260206004820152602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201526c1bdd08184818dbdb9d1c9858dd609a1b60648201526084016105eb565b600080516020611f5f83398151915280546001600160a01b0319166001600160a01b0392909216919091179055565b61151d83611627565b60008251118061152a5750805b15611252576115398383611667565b50505050565b600080806110046115548a8a8a8a8a8a61175b565b6040516115619190611c68565b6000604051808303816000865af19150503d806000811461159e576040519150601f19603f3d011682016040523d82523d6000602084013e6115a3565b606091505b50915091506115e1828260405180604001604052806016815260200175199a5c0b58dc9bdcdccb58da185a5b8819985a5b195960521b8152506117ae565b6115ea81611828565b9998505050505050505050565b600054610100900460ff1661161e5760405162461bcd60e51b81526004016105eb90611de3565b610919336112b1565b61163081611478565b6040516001600160a01b038216907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b90600090a250565b60606001600160a01b0383163b6116cf5760405162461bcd60e51b815260206004820152602660248201527f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f6044820152651b9d1c9858dd60d21b60648201526084016105eb565b600080846001600160a01b0316846040516116ea9190611c68565b600060405180830381855af49150503d8060008114611725576040519150601f19603f3d011682016040523d82523d6000602084013e61172a565b606091505b50915091506117528282604051806060016040528060278152602001611f7f6027913961183f565b95945050505050565b606086868686868660405160240161177896959493929190611cc1565b60408051601f198184030181529190526020810180516001600160e01b0316633c3e7d7760e01b17905290509695505050505050565b82611252576000828060200190518101906117c99190611add565b90506001825110156117ef578060405162461bcd60e51b81526004016105eb9190611d09565b8181604051602001611802929190611c84565b60408051601f198184030181529082905262461bcd60e51b82526105eb91600401611d09565b600080828060200190518101906106199190611aa5565b6060831561184e575081610619565b61061983838151156118635781518083602001fd5b8060405162461bcd60e51b81526004016105eb9190611d09565b82805461188990611ee2565b90600052602060002090601f0160209004810192826118ab57600085556118f1565b82601f106118c457805160ff19168380011785556118f1565b828001600101855582156118f1579182015b828111156118f15782518255916020019190600101906118d6565b506118fd929150611901565b5090565b5b808211156118fd5760008155600101611902565b600061192961192484611e5f565b611e2e565b905082815283838301111561193d57600080fd5b828260208301376000602084830101529392505050565b600082601f830112611964578081fd5b61061983833560208501611916565b600060208284031215611984578081fd5b813561061981611f49565b600080604083850312156119a1578081fd5b82356119ac81611f49565b946020939093013593505050565b600080604083850312156119cc578182fd5b82356119d781611f49565b915060208301356119e781611f49565b809150509250929050565b600080600060608486031215611a06578081fd5b8335611a1181611f49565b92506020840135611a2181611f49565b929592945050506040919091013590565b60008060408385031215611a44578182fd5b8235611a4f81611f49565b9150602083013567ffffffffffffffff811115611a6a578182fd5b8301601f81018513611a7a578182fd5b611a8985823560208401611916565b9150509250929050565b600080604083850312156119a1578182fd5b600060208284031215611ab6578081fd5b81518015158114610619578182fd5b600060208284031215611ad6578081fd5b5051919050565b600060208284031215611aee578081fd5b815167ffffffffffffffff811115611b04578182fd5b8201601f81018413611b14578182fd5b8051611b2261192482611e5f565b818152856020838501011115611b36578384fd5b611752826020830160208601611eb6565b60008060008060808587031215611b5c578081fd5b843567ffffffffffffffff80821115611b73578283fd5b611b7f88838901611954565b95506020870135915080821115611b94578283fd5b50611ba187828801611954565b935050604085013560ff81168114611bb7578182fd5b91506060850135611bc781611f49565b939692955090935050565b60008060008060808587031215611be7578384fd5b843567ffffffffffffffff811115611bfd578485fd5b611c0987828801611954565b97602087013597506040870135966060013595509350505050565b600060208284031215611c35578081fd5b5035919050565b60008151808452611c54816020860160208601611eb6565b601f01601f19169290920160200192915050565b60008251611c7a818460208701611eb6565b9190910192915050565b60008351611c96818460208801611eb6565b6101d160f51b9083019081528351611cb5816002840160208801611eb6565b01600201949350505050565b6001600160a01b038716815260c060208201819052600090611ce590830188611c3c565b86604084015285606084015284608084015282810360a08401526115ea8185611c3c565b6000602082526106196020830184611c3c565b600060808252611d2f6080830187611c3c565b6020830195909552506040810192909252606090910152919050565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b19195b1959d85d1958d85b1b60a21b606082015260800190565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b6163746976652070726f787960a01b606082015260800190565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b606082015260800190565b604051601f8201601f1916810167ffffffffffffffff81118282101715611e5757611e57611f33565b604052919050565b600067ffffffffffffffff821115611e7957611e79611f33565b50601f01601f191660200190565b60008219821115611e9a57611e9a611f1d565b500190565b600082821015611eb157611eb1611f1d565b500390565b60005b83811015611ed1578181015183820152602001611eb9565b838111156115395750506000910152565b600281046001821680611ef657607f821691505b60208210811415611f1757634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fd5b6001600160a01b038116811461076e57600080fdfe360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c206661696c6564a264697066735822122032394489585b53c5cfa96a7005f1823a957d6d88ed6d5d45edd24f36211ada4864736f6c63430008020033")
)

var (
	fip20Init = Contract{
		Address: common.HexToAddress(FIP20LogicAddress),
		ABI:     MustABIJson(FIP20UpgradableMetaData.ABI),
		Bin:     MustDecodeHex(FIP20UpgradableMetaData.Bin),
		Code:    initFIP20Code,
	}
	wfxInit = Contract{
		Address: common.HexToAddress(WFXLogicAddress),
		ABI:     MustABIJson(WFXUpgradableMetaData.ABI),
		Bin:     MustDecodeHex(WFXUpgradableMetaData.Bin),
		Code:    initWFXCode,
	}
	erc1967Proxy = Contract{
		Address: common.Address{},
		ABI:     MustABIJson(ERC1967ProxyMetaData.ABI),
		Bin:     MustDecodeHex(ERC1967ProxyMetaData.Bin),
		Code:    []byte{},
	}

	fxBridgeABI = MustABIJson(IFxBridgeLogicMetaData.ABI)
)

type Contract struct {
	Address common.Address
	ABI     abi.ABI
	Bin     []byte
	Code    []byte
}

func (c Contract) CodeHash() common.Hash {
	return crypto.Keccak256Hash(c.Code)
}

func GetFIP20() Contract {
	return fip20Init
}

func GetWFX() Contract {
	return wfxInit
}

func GetERC1967Proxy() Contract {
	return erc1967Proxy
}

func GetFxBridgeABI() abi.ABI {
	return fxBridgeABI
}

func MustDecodeHex(str string) []byte {
	bz, err := hexutil.Decode(str)
	if err != nil {
		panic(err)
	}
	return bz
}

func MustABIJson(str string) abi.ABI {
	j, err := abi.JSON(strings.NewReader(str))
	if err != nil {
		panic(err)
	}
	return j
}
